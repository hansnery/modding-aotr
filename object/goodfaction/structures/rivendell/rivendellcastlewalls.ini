//////////////////////////////////////////////////////////////
//														    //
//    CASTLE WALL PIECES FOR THE NEW WALL BUILD SYSTEM	    //
//														    //
//////////////////////////////////////////////////////////////
Object RivendellCastleWallSegment
  
	// *** ART Parameters ***  
  	SelectPortrait = BPRivendellWall
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		RandomTexture = ABRivConservExp.tga 0 EBFortress.tga		
		
		DefaultModelConditionState
			Model = EBWallN
		End

		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model =  EBWallN_CUR
		End
		
;		ModelConditionState = SNOW BUILD_PLACEMENT_CURSOR
;			Model = EBWallN_CUR
;			Texture	= DBFortress1.tga DBFortress1_snow.tga
;		End
						
		IdleAnimationState
			StateName = STATE_None
		End	
		
		//------------ New Build Up States coming soon. 
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = EBWallN_A
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End
				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = EBWallN_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  EBWallN_A
				AnimationName     =  EBWallN_A.EBWallN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= EBWallN_A
			Texture	= EBFortress.tga EBFortress_U.tga
		End
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = EBWallN_A
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = EBWallN_A
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = EBWallN_A
				AnimationName     = EBWallN_A.EBWallN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End

		//--damaged building	  
		ModelConditionState  = DAMAGED
			Model         = EBWallN_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = EBWallN_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 EBWallN_D2.EBWallN_D2
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = EBWallN_D3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 EBWallN_D3.EBWallN_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
		End

		ModelConditionState  = RUBBLE
			Model         = None	;GBWall_Rubble  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= EBWallN
			Texture	= EBFortress.tga EBFortress_U.tga
		End
		ModelConditionState = SNOW  
			Model = EBWallN
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End	    

	End


	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState  = COLLAPSING
			Model         = GBWall_Rubble
		End
		
		ModelConditionState  = RUBBLE
			Model         = GBWall_Rubble
		End
	    
		ModelConditionState  = POST_RUBBLE
			Model         = GBWall_Rubble
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End
	
    Draw = W3DFloorDraw ModuleTag_DrawFloor    
  		StaticModelLODMode		=	yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName				=	GBWallN_Bib
  		WeatherTexture			=	SNOWY GBWall_Bib_Snow.tga
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
  		HideIfModelConditions	=	COLLAPSING
  		HideIfModelConditions	=	RUBBLE
	End	
     
	; ***DESIGN parameters ***
	DisplayName         = OBJECT:ElvenCastleWallSegment
	Side                = Rivendell
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = 100 ; ELVEN_CASTLE_WALLSEGMENT_BUILDCOST
	BuildTime           = ELVEN_CASTLE_WALLSEGMENT_BUILDTIME
	VisionRange         = 160.0          // Shroud clearing distance
	ShroudClearingRange = 160
	CommandSet			= ElvenWallUpgradeNodeCommandSet
	  
	ArmorSet
		Conditions        = None
		Armor             = ElvenWallArmor	
	End

  ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= Gui_PlotSelect2
    VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE WALL_SEGMENT SCALEABLE_WALL MADE_OF_STONE
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
 
	//This is important to let the user select the rubble to begin self repair
	KeepSelectableWhenDead	= Yes

 
	Behavior            = GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= ELVEN_CASTLE_WALLSEGMENT_BUILDTIME
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= ELVEN_CASTLE_WALLSEGMENT_HEALTH
		MaxHealthDamaged		= ELVEN_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ELVEN_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
	End
 
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments

	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
		ReplaceWith = RivendellCastleWallHub
		TriggeredBy = Upgrade_ElvenWallHub
		ConflictsWith = Upgrade_ElvenWallRegularGate Upgrade_DwarvenWallTower Upgrade_DwarvenWallPosternGate
	End
		
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
		ReplaceWith = RivendellCastleWallGate
		TriggeredBy = Upgrade_ElvenWallRegularGate
		ConflictsWith = Upgrade_ElvenWallHub Upgrade_DwarvenWallTower Upgrade_DwarvenWallPosternGate
	End
	
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Tower
		ReplaceWith = RivendellWallTowerSmall
		TriggeredBy = Upgrade_DwarvenWallTower
		ConflictsWith = Upgrade_ElvenWallRegularGate Upgrade_ElvenWallHub Upgrade_DwarvenWallPosternGate
	End
	
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_PosternGate
		ReplaceWith = RivendellWallPosternGateSmall
		TriggeredBy = Upgrade_DwarvenWallPosternGate
		ConflictsWith = Upgrade_ElvenWallRegularGate Upgrade_ElvenWallHub Upgrade_DwarvenWallTower
	End	

	Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
	End

	//Encasing Vines
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_ElvenFortressEncasingVines
		ObjectFilter = ANY +ElvenCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_ElvenFortressEncasingVines
		AttributeModifier		= EncasingVinesExpansion_Bonus
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheVines
		TriggeredBy			= Upgrade_ElvenFortressEncasingVines		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	//End Encasing Vines

	;//	Geometry for the temp men small wall segment
	Geometry              = BOX
	GeometryMajorRadius   = 4.0		;10.0
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 50.0
	GeometryIsSmall       = No
	  
	;Geometry              = BOX
	;GeometryMajorRadius   = 25.0
	;GeometryMinorRadius   = 20.0
	;GeometryHeight        = 50
	;GeometryIsSmall       = No
	  
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

//---------------------------------------------
Object RivendellCastleWallHub
  
	// *** ART Parameters ***
  
  	SelectPortrait  =  BPRivendellHub
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		
		DefaultModelConditionState
			Model = ABWallHub
		End

		IdleAnimationState
			StateName = STATE_None
		End	
		

		//------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = ABWallHub_BLD
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga
		End
				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = ABWallHub_BLD
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  ABWallHub_BLD
				AnimationName     =  ABWallHub_BLD.ABWallHub_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= ABWallHub_BLD
			Texture	= EBFortress.tga EBFortress_U.tga
		End
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = ABWallHub_BLD
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga
			;Texture = EBDome.tga EBDome_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = ABWallHub_BLD
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = ABWallHub_BLD
				AnimationName     = ABWallHub_BLD.ABWallHub_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End


		//--damaged building	  
		ModelConditionState  = DAMAGED
			Model         = ABWallHub
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_BuildingDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = ABWallHub
		End
	    
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 ABWallHub.ABWallHub
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = ABWallHub
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 ABWallHub.ABWallHub
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End

		ModelConditionState  = DYING
			Model         = ABWallHub
		End
		
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 ABWallHub.ABWallHub
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End



		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
		End
		AnimationState = POST_RUBBLE
		End


		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		
		AnimationState = POST_COLLAPSE
		End 

		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK
			Model	= ABWallHub
			Texture	= EBFortress.tga EBFortress_U.tga
		End

		ModelConditionState = SNOW  
			Model = ABWallHub
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga
			;Texture = EBDome.tga EBDome_snow.tga
		End	   

	End
 
	// ***DESIGN parameters ***
	DisplayName         = OBJECT:ElvenCastleWallHub
	Side                = Rivendell
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = 300 ; ELVEN_CASTLE_WALLHUB_BUILDCOST
	BuildTime           = ELVEN_CASTLE_WALLHUB_BUILDTIME		// in seconds
	VisionRange         = ELVEN_CASTLE_WALLHUB_VISION_RANGE
	ShroudClearingRange = ELVEN_CASTLE_WALLHUB_SHROUD_CLEAR

	CommandSet = ElvenCastleWallHubCommandSet	

  ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= NeutralWallHubSelect
    VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	;ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
	;	ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	;End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB MADE_OF_STONE WALL_UPGRADE
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End

	ArmorSet	;;.;; 2.02 balance - wall hubs are no longer frequent rape victims
		Conditions        = None
		Armor             = ElvenWallArmor	
	End
 
	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius			= 60		// How far we try to claim ground
		MaxIncome		= 0			// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= 999999	// How often (in msec) we give that much money
		HighPriority	= Yes		// A high priority claim gets to pretend it was there first.
		Visible = No 		;// Don't show decal when a resource building is selected.
	End

	Behavior            = GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		;SelfBuildingLoop			= BuildingConstructionLoop	// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= BuildingConstructionLoop
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= ELVEN_CASTLE_WALLHUB_HEALTH
		MaxHealthDamaged		= ELVEN_CASTLE_WALLHUB_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ELVEN_CASTLE_WALLHUB_HEALTH_REALLY_DAMAGED
	End

	Behavior				= SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End
	
	Behavior = WallHubBehavior ModuleTag_WALL_HUB

		Options = OPTION_ONE
		MaxBuildoutDistance = 1000 ; ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS ;;,;; MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		
		StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR

		//This defines the pattern built on flat terrain
		SegmentTemplateName = RivendellCastleWallSegment
		SegmentTemplateName = RivendellCastleWallSegment
		SegmentTemplateName = RivendellCastleWallSegment
		SegmentTemplateName = RivendellCastleWallSegment
		SegmentTemplateName = RivendellCastleWallSegment
;;,;; ; ; 		SegmentTemplateName = ElvenCastleWallSegment
;;,;; ; ; 		SegmentTemplateName = ElvenCastleWallSegment
;;,;; ; ; 		SegmentTemplateName = ElvenCastleWallSegment
		SegmentTemplateName = RivendellCastleWallHub
		
		BuilderRadius = 20

		HubCapTemplateName = RivendellCastleWallHub
		DefaultSegmentTemplateName = RivendellCastleWallSegment

		CliffCapTemplateName = RivendellWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]

	End
	
	

	//Encasing Vines
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_ElvenFortressEncasingVines
		ObjectFilter = ANY +ElvenCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_ElvenFortressEncasingVines
		AttributeModifier		= EncasingVinesExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheVines
		TriggeredBy			= Upgrade_ElvenFortressEncasingVines		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	//End Encasing Vines

	//	Geometry for the temp small men wall hub
	Geometry              = CYLINDER
	GeometryMajorRadius   = 20.0 ; 
	GeometryMinorRadius   = 20.0 ; 
	GeometryHeight        = 70.0
	GeometryIsSmall       = No
	
	; additional geometry, exactly same as the wall piece - if this isn't here we might get holes!	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 4.0		;10.0
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 50.0
	GeometryIsSmall       = No
	
	;Geometry              = CYLINDER
	;GeometryMajorRadius   = 50.0
	;GeometryMinorRadius   = 50.0
	;GeometryHeight        = 50.0
	;GeometryIsSmall       = No
	  
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End


Object RivendellCastleWallGate

	Scale = 1.06

	// *** ART Parameters ***   
   	SelectPortrait = BPRivendellGate
   
 	Draw = W3DScriptedModelDraw ModuleTag_Draw
 		OkToChangeModelColor  = Yes
 		UseStandardModelNames = Yes
 		
		DefaultModelConditionState
 			Model = ABWallGate
 		End

		//--------- damage states for the gate
		ModelConditionState   = DAMAGED
			Model               = ABWallGate_D1
		End
		
		ModelConditionState   = REALLYDAMAGED
			Model               = ABWallGate_D2
		End

		;ModelConditionState  = COLLAPSING DOOR_1_OPENING
		;	Model         = ABWallGate_D3
		;End
		;AnimationState = COLLAPSING DOOR_1_OPENING
      	;	Animation				=	RubbleAnimation
		;		AnimationName		=	 ABWallGate_D3.ABWallGate_D3
		;		AnimationMode		=	ONCE
  		;	End
  		;	EnteringStateFX	= FX_StructureMediumCollapse
  		;	ParticleSysBone NONE HubDestructionDust
		;End

		;ModelConditionState  = DYING DOOR_1_OPENING
		;	Model         = ABWallGate_D3
		;End
		;AnimationState = DYING DOOR_1_OPENING
      	;	Animation				=	RubbleAnimation
		;		AnimationName		=	 ABWallGate_D3.ABWallGate_D3
		;		AnimationMode		=	ONCE
  		;	End
    	;	EnteringStateFX	= FX_StructureMediumCollapse
  		;	ParticleSysBone NONE HubDestructionDust
		;End
	
		ModelConditionState  = COLLAPSING
			Model         = ABWallGate_D3
		End
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 ABWallGate_D3.ABWallGate_D3
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End

		;ModelConditionState  = DYING
		;	Model         = ABWallGate_D3
		;End
		;AnimationState = DYING
      	;	Animation				=	RubbleAnimation
		;		AnimationName		=	 ABWallGate_D3.ABWallGate_D3
		;		AnimationMode		=	ONCE
  		;	End
  		;	EnteringStateFX	= FX_StructureMediumCollapse
  		;	ParticleSysBone NONE HubDestructionDust
		;End

		ModelConditionState  = RUBBLE
			;Model         = ABWallGate_R
			Model		   = None
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_COLLAPSE
		End 

		//--------- door animations
		ModelConditionState   = DAMAGED DOOR_1_OPENING
			Model               = ABWallGate_D1O
		End
		AnimationState = DAMAGED DOOR_1_OPENING 
			Flags = START_FRAME_LAST
			StateName = Door_Open
			Animation				=	Death
				AnimationName		=	ABWallGate_D1O.ABWallGate_D1O
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			;EndScript
		End
		ModelConditionState   = REALLYDAMAGED DOOR_1_OPENING
			Model               = ABWallGate_D2O
		End
		AnimationState = REALLYDAMAGED DOOR_1_OPENING 
			Flags = START_FRAME_LAST
			StateName = Door_Open
			Animation				=	Death
				AnimationName		=	ABWallGate_D2O.ABWallGate_D2O
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			;EndScript
		End
		ModelConditionState   = DOOR_1_OPENING SNOW
			Model               = ABWallGate_OPN
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga			
		End		
		ModelConditionState   = DOOR_1_OPENING
			Model               = ABWallGate_OPN
		End		
		AnimationState = DOOR_1_OPENING 
			Flags = START_FRAME_LAST
			StateName = Door_Open
			Animation				=	Death
				AnimationName		=	ABWallGate_OPN.ABWallGate_OPN
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			;EndScript
		End
		TransitionState = TRANS_Closed_To_Open
			Animation = Open 
				AnimationName	=	ABWallGate_OPN.ABWallGate_OPN
				AnimationMode	=	ONCE 
			End
		End
 		ModelConditionState   = DAMAGED DOOR_1_CLOSING
			Model               = ABWallGate_D1O
		End   
		AnimationState = DAMAGED DOOR_1_CLOSING 
			Flags = START_FRAME_FIRST
			StateName = Door_Close
			Animation				=	Death
				AnimationName		=	ABWallGate_D1O.ABWallGate_D1O
				AnimationMode		=	ONCE_BACKWARDS
				AnimationSpeedFactorRange	= 0.1 0.1			
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			;EndScript
		End
 		ModelConditionState   = REALLYDAMAGED DOOR_1_CLOSING
			Model               = ABWallGate_D2O
		End   
		AnimationState = REALLYDAMAGED DOOR_1_CLOSING 
			Flags = START_FRAME_FIRST
			StateName = Door_Close
			Animation				=	Death
				AnimationName		=	ABWallGate_D2O.ABWallGate_D2O
				AnimationMode		=	ONCE_BACKWARDS
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			;EndScript
		End
		ModelConditionState   = DOOR_1_CLOSING SNOW
			Model               = ABWallGate_OPN
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga			
		End			
 		ModelConditionState   = DOOR_1_CLOSING
			Model               = ABWallGate_OPN
		End   
		AnimationState = DOOR_1_CLOSING 
			Flags = START_FRAME_FIRST
			StateName = Door_Close
			Animation				=	Death
				AnimationName		=	ABWallGate_OPN.ABWallGate_OPN
				AnimationMode		=	ONCE_BACKWARDS
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			;EndScript
		End
		TransitionState = TRANS_Open_To_Closed
			Animation = Open 
				AnimationName	=	ABWallGate_OPN.ABWallGate_OPN
				AnimationMode	=	ONCE 
			End
		End
		
		ModelConditionState = SNOW  
			Model	= ABWallGate
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga
		End	   		
		
 	End
      
	// ***DESIGN parameters ***
	DisplayName         = OBJECT:ElvenCastleWallGate
	Side                = Rivendell
	EditorSorting       = STRUCTURE
	ThreatLevel			= 1.0
	  
	BuildCost           = ELVEN_CASTLE_WALLGATE_BUILDCOST
	BuildTime           = ELVEN_CASTLE_WALLGATE_BUILDTIME		// in seconds
	VisionRange         = ELVEN_CASTLE_WALLGATE_VISION_RANGE     // Shroud clearing distance
	ShroudClearingRange = ELVEN_CASTLE_WALLGATE_SHROUD_CLEAR
	   
	CommandSet			= CastleGateCommandSet
 
	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= GateSelect
    VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

 	SoundOnDamaged					= BuildingLightDamageStone
 	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_UPGRADE MADE_OF_STONE BLOCKING_GATE WALL_GATE
	ThreatBreakdown ThreatBreakdown_ModuleTag
	;	AIKindOf = WALL
	End
	  
	Behavior            = GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		SpawnTimer					= -1.0							// Negative means no 'autoheal'
		RebuildTimeSeconds			= ELVEN_CASTLE_WALLGATE_BUILDTIME
	End
	
	ArmorSet
		Conditions        = None
		Armor             = ElvenWallArmor	
	End
 
	Body                = StructureBody ModuleTag_05
		MaxHealth				= ELVEN_CASTLE_WALLGATE_HEALTH
		MaxHealthDamaged		= ELVEN_CASTLE_WALLGATE_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ELVEN_CASTLE_WALLGATE_HEALTH_REALLY_DAMAGED
	End
  
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay = 5000
	End	
		
	Behavior = GateOpenAndCloseBehavior ModuleTag_GATE
		ResetTimeInMilliseconds			= 3000				//important! this must be longer than the gates animation, ir it will twitch
		OpenByDefault					= No
		PercentOpenForPathing			= 50
		SoundOpeningGateLoop			= GateOpenStart
		SoundClosingGateLoop			= GateCloseStart
		SoundFinishedOpeningGate		= GateOpenEnd
		SoundFinishedClosingGate		= GateCloseEnd
		TimeBeforePlayingOpenSound		= 9500
		TimeBeforePlayingClosedSound	= 9500
	End
	
	//Encasing Vines
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_ElvenFortressEncasingVines
		ObjectFilter = ANY +ElvenCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_ElvenFortressEncasingVines
		AttributeModifier		= EncasingVinesExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheVines
		TriggeredBy			= Upgrade_ElvenFortressEncasingVines		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End

	Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
		AllowEnemies			= No
		AllowNonSkirmishAIUnits	= No
	End
	
	Behavior = AIGateUpdate ModuleTage_AIGateUpdate
		TriggerWidthX = 300.0
		TriggerWidthY = 150.0
	End

	//End Encasing Vines

	//	Geometry from small men wall gate
	GeometryIsSmall			= No

	// right pillar
	Geometry              	= BOX
	GeometryMajorRadius   	= 10.0  
	GeometryMinorRadius   	= 10.0  
	GeometryHeight        	= 75
	GeometryOffset        	= X:0 Y:50 Z:0
	
	// left pillar
	AdditionalGeometry    	= BOX
	GeometryMajorRadius   	= 10.0  
	GeometryMinorRadius   	= 10.0  
	GeometryHeight        	= 75
	GeometryOffset        	= X:0 Y:-50 Z:0

	// Main
	AdditionalGeometry    	= BOX
	GeometryName		  	= "Closed"
	GeometryMajorRadius   	= 9.0  
	GeometryMinorRadius   	= 50.0  
	GeometryHeight        	= 50
	
	// Left open
	AdditionalGeometry    	= BOX
	GeometryName		  	= "OpenLeft"
	GeometryMajorRadius   	= 9.0  
	GeometryMinorRadius   	= 10.0  
	GeometryHeight        	= 40
	GeometryOffset        	= X:0 Y:-30 Z:0
	
	// Right open
	AdditionalGeometry    	= BOX
	GeometryName		  	= "OpenRight"
	GeometryMajorRadius   	= 9.0  
	GeometryMinorRadius   	= 10.0  
	GeometryHeight        	= 40
	GeometryOffset        	= X:0 Y:30 Z:0
	
	GeometryContactPoint	= X:0 Y:-50 Z:75
	GeometryContactPoint	= X:0 Y:-50 Z:10
	GeometryContactPoint	= X:0 Y:50 Z:10
	GeometryContactPoint	= X:0 Y:50 Z:75
   
	Shadow					= SHADOW_VOLUME
	BuildCompletion			= PLACED_BY_PLAYER
End
   
   
//---------------------------------------   
Object RivendellWallCliffCap

	//*** ART Parameters ***
	SelectPortrait  	=  BPRivendellWall
  
	
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		
		RandomTexture = ABRivConservExp.tga 0 EBFortress.tga		
		
		DefaultModelConditionState
			Model = EBWallNE
		End

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = EBWallNE_A
			Texture	= EBFortress.tga EBFortress_U.tga
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End				
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = EBWallNE_A
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = EBWallNE_A
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           =  EBWallNE_A
				AnimationName     =  EBWallNE_A.EBWallNE_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End
				
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
   			StateName = STATE_None
		End	


		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = EBWallNE_D1
		End
		
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = EBWallNE_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 EBWallNE_D2.EBWallNE_D2
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = EBWallNE_D3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 EBWallNE_D3.EBWallNE_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = RUBBLE
			Model         = None	;GBWall_Rubble  
		End  
		AnimationState = RUBBLE
		End
		
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= EBWallNE
			Texture	= EBFortress.tga EBFortress_U.tga
		End
				
		ModelConditionState = SNOW  
			Model = EBWallNE
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End		
		
	End
   
;    Draw = W3DFloorDraw ModuleTag_DrawFloor    
;;    		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
;  		ModelName = EBWallN_Bib
;	End
  
	// ***DESIGN parameters ***
	DisplayName         = OBJECT:ElvenCastleWallSegment
	Side                = Rivendell
	EditorSorting       = STRUCTURE
	ThreatLevel			= 1.0
 
	CommandSet			= ElvenWallCliffCapCommandSet
 
	BuildCost           = 100 ; MEN_WALLSEGMENT_SMALL_BUILDCOST
	BuildTime           = MEN_WALLSEGMENT_SMALL_BUILDTIME
	VisionRange         = MEN_WALLSEGMENT_SMALL_VISION_RANGE
	ShroudClearingRange = MEN_WALLSEGMENT_SMALL_SHROUD_CLEAR

	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE DEFENSIVE_WALL MADE_OF_STONE ;;,;; ; ; Removed CAN_CAST_REFLECTIONS
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
	
	ArmorSet	;;.;; 2.02 balance - wall caps are no longer frequent rape victims
		Conditions        = None
		Armor             = ElvenWallArmor	
	End	
	
	Behavior            = GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		;RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop	// Only played if we DON'T spawn a worker
		;SelfRepairFromDamageLoop	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= ELVEN_CASTLE_WALLSEGMENT_HEALTH
		MaxHealthDamaged		= ELVEN_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ELVEN_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
	End
	 
;	Behavior            = DestroyDie ModuleTag_07
;		//nothing
;	End

	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments
	
	//Encasing Vines
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_ElvenFortressEncasingVines
		ObjectFilter = ANY +ElvenCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_ElvenFortressEncasingVines
		AttributeModifier		= EncasingVinesExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheVines
		TriggeredBy			= Upgrade_ElvenFortressEncasingVines		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	//End Encasing Vines

	Geometry              	= BOX
	GeometryMajorRadius   	= 10.0 
	GeometryMinorRadius   	= 40.0   
	GeometryHeight			= 80
	GeometryIsSmall			= No
	GeometryOffset			= X:0 Y:-20 Z:-40
	  
	  
	Shadow					= SHADOW_VOLUME
	BuildCompletion			= PLACED_BY_PLAYER
End

;---------------------------------------------
Object RivendellWallTowerSmall
  ; *** ART Parameters ***
  
  	SelectPortrait = BPRivendellWallTower
  
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes	
		ExtraPublicBone = Arrow01
		ExtraPublicBone = Arrow02
		ExtraPublicBone = Arrow03
		ExtraPublicBone = Arrow04
		DefaultModelConditionState
			Model				= ABWallTwr
			WeaponLaunchBone    = PRIMARY ARROW
		End
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
;  			StateName = STATE_None
		End	


		;------------ New Build Up States coming soon. 
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = ABWallTwr_BLD
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  DBWallTwrN_A
				AnimationName     =  ABWallTwr_BLD.ABWallTwr_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
;			Model		= DBWallTwrN_A
;			Texture		= DBFortress1.tga DBFortress_U.tga
;		End

		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = ABWallTwr_BLD
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = DBWallTwrN_A
				AnimationName     = ABWallTwr_BLD.ABWallTwr_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
;			StateName			  = BeingConstructed
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End		


		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = ABWallTwr_D1
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = ABWallTwr_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		; Animation				=	RubbleAnimation
				; AnimationName		=	 DBWallTwrN_D2.DBWallTwrN_D2
				; AnimationMode		=	ONCE
  			; End
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = ABWallTwr_D2
		End
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 ABWallTwr_D2.ABWallTwr_D2
				AnimationMode		=	ONCE
  			End
			EnteringStateFX			= FX_StructureMediumCollapse
		End
		
		ModelConditionState  = DYING
			Model         = ABWallTwr_D2
		End
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 ABWallTwr_D2.ABWallTwr_D2
				AnimationMode		=	ONCE
  			End
			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_COLLAPSE
		End 

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwalltwr_skn
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		
		ModelConditionState = SNOW  
			Model = ABWallTwr
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga
		End	 

		
	End
 
 	; Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		; StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		; ModelName = DBWallTwrN_Bib
  		; WeatherTexture		= SNOWY DBWall_Bib_Snow.tga 
	; End
 
	; ***DESIGN parameters ***
	DisplayName         	= OBJECT:DwarvenCastleWallTowerSmall
	Side                	= Rivendell
	EditorSorting       	= STRUCTURE
	ThreatLevel		= TOWER_THREAT_LEVEL	; 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = DWARVEN_WALLTOWER_SMALL_BUILDCOST
	BuildTime           = DWARVEN_WALLTOWER_SMALL_BUILDTIME           ; in seconds
	VisionRange         = DWARVEN_WALLTOWER_SMALL_VISION_RANGE        ; Shroud clearing distance
	ShroudClearingRange = DWARVEN_WALLTOWER_SMALL_SHROUD_CLEAR

	CommandSet	= SellableCommandSet

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= MenArrowTowerExpansionSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE CAN_ATTACK IGNORE_FOR_VICTORY WALL_UPGRADE
 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	ArmorSet ;;,;;
		Conditions        = None
		Armor             = ElvenWallArmor
		DamageFX          = None
	End

	WeaponSet
		Conditions			= None
		Weapon				= PRIMARY CastleWallUpgradeBow
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
 
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
 		AutoAcquireEnemiesWhenIdle	= Yes
 		MoodAttackCheckRate			= 250
 	End
 
	Body = StructureBody ModuleTag_05
		MaxHealth = 1500.0
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
		;CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End
	 
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End												

	GeometryIsSmall       = No
	
	Geometry			  = BOX
	GeometryMajorRadius   = 15.0 
	GeometryMinorRadius   = 15.0 
	GeometryHeight        = 40.0
	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 10.0 
	GeometryMinorRadius   = 10.0 
	GeometryHeight        = 50.0
	GeometryOffset		  = X:0 Y:0 Z:40
	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No

	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object RivendellWallPosternGateSmall
  
  ; *** ART Parameters ***
  
  	SelectPortrait = UPRivendellPosterngate
  	
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		
		ExtraPublicBone = PATH01
		ExtraPublicBone = PATH02
		ExtraPublicBone = PATH03
		ExtraPublicBone = PATH04
	
		DefaultModelConditionState
			Model = ABWallPost
		End
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
;  			StateName = STATE_None
		End	


		;------------ New Build Up States coming soon. 
;		ModelConditionState   = AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
;			Model               = DBWallPGN_A
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState   = AWAITING_CONSTRUCTION SNOW
			;Model               = DBWallPGN_A
			;Texture = dbfortress.tga dbfortress_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End
		ModelConditionState   = AWAITING_CONSTRUCTION 
			;Model               = DBWallPGN_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			;Animation           =  DBWallPGN_A
			;	AnimationName     =  DBWallPGN_A.DBWallPGN_A
			;	AnimationMode     = MANUAL
			;	AnimationBlendTime = 0
			;End
			;Flags				  = START_FRAME_FIRST
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End
;		ModelConditionState		= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;			Model		= DBWallPGN_A
;			Texture		= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState		= SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Model		= DBWallPGN_A
			;Texture = dbfortress.tga dbfortress_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Model               = DBWallPGN_A
			;ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Animation           = DBWallPGN_A
			;	AnimationName     = DBWallPGN_A.DBWallPGN_A
			;	AnimationMode     = MANUAL
			;	AnimationBlendTime = 0
			;End
			;Flags				  = START_FRAME_FIRST
;			StateName			  = BeingConstructed
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End

		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = ABWallPost
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = ABWallPost
		End
	    
	    AnimationState = REALLYDAMAGED
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
		End
		
		AnimationState = COLLAPSING
			EnteringStateFX			= FX_StructureMediumCollapse
		End
		AnimationState = DYING
 			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = DYING
			Model         = None
		End

		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		
		AnimationState = POST_COLLAPSE
		End 

;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallpstrn_skn
;			;Texture	= DBFortress1.tga DBFortress_U.tga
;		End

		ModelConditionState = SNOW  
			Model = ABWallPost
			Texture	= ABRivConservExp.tga ABRivConservExp_snow.tga			
		End	 
	End
	
	Draw = W3DScriptedModelDraw ModuleTag_DrawWall
		AffectedByStealth		= No
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		RandomTexture = ABRivConservExp.tga 0 EBFortress.tga		
		
		DefaultModelConditionState
			Model = EBWallN
		End

		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model =  EBWallN_CUR
		End
		
;		ModelConditionState = SNOW BUILD_PLACEMENT_CURSOR
;			Model = EBWallN_CUR
;			Texture	= DBFortress1.tga DBFortress1_snow.tga
;		End
						
		IdleAnimationState
			StateName = STATE_None
		End	
		
		//------------ New Build Up States coming soon. 
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = EBWallN_A
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End
				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = EBWallN_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  EBWallN_A
				AnimationName     =  EBWallN_A.EBWallN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= EBWallN_A
			Texture	= EBFortress.tga EBFortress_U.tga
		End
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = EBWallN_A
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = EBWallN_A
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = EBWallN_A
				AnimationName     = EBWallN_A.EBWallN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End

		//--damaged building	  
		ModelConditionState  = DAMAGED
			Model         = EBWallN_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = EBWallN_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 EBWallN_D2.EBWallN_D2
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = EBWallN_D3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 EBWallN_D3.EBWallN_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
		End

		ModelConditionState  = RUBBLE
			Model         = None	;GBWall_Rubble  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= EBWallN
			Texture	= EBFortress.tga EBFortress_U.tga
		End
		ModelConditionState = SNOW  
			Model = EBWallN
			Texture	= EBFortress.tga ABRivConservExp_snow.tga
		End    

	End

 	Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName = DBWallPGN_Bib
  		WeatherTexture		= SNOWY DBWall_Bib_Snow.tga 
	End
	 
	; ***DESIGN parameters ***
	DisplayName         		= OBJECT:DwarvenCastleWallPosternGateSmall
	DisplayNameInvisibleForEnemy    = OBJECT:DwarvenCastleWallSegment
	Side                		= Rivendell
	EditorSorting       		= STRUCTURE
	ThreatLevel 			= WALL_THREAT_LEVEL	; 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = DWARVEN_POSTERNGATE_SMALL_BUILDCOST
	BuildTime           = DWARVEN_POSTERNGATE_SMALL_BUILDTIME           ; in seconds
	VisionRange         = DWARVEN_POSTERNGATE_SMALL_VISION_RANGE         ; Shroud clearing distance
	ShroudClearingRange = DWARVEN_POSTERNGATE_SMALL_SHROUD_CLEAR

	ArmorSet	;;,;;
		Conditions        = None
		Armor             = ElvenWallArmor
		DamageFX          = None
	End

	CommandSet	= SellableCommandSet

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= GondorPosternGateSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE IGNORE_FOR_VICTORY WALL_UPGRADE
 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth         = DWARVEN_POSTERNGATE_SMALL_HEALTH
	End
	 
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End												
	
	Behavior = DynamicPortalBehaviour PosternGatePortal
		ActivationDelaySeconds	= 0.0
		GenerateNow				= Yes
		
		ObjectFilter	= AOTR_POSTERNGATE_ALLOWABLE_OBJECTFILTER
		BonePrefix		= PATH
		NumberOfBones	= 4
		WayPoint		= Index:0	Type:Walk	; 0
		WayPoint		= Index:1	Type:Walk	; 1
		WayPoint		= Index:2	Type:Walk	; 2
		WayPoint		= Index:3	Type:Walk	; 3
		WayPoint		= Index:2	Type:Walk	; 4
		WayPoint		= Index:1	Type:Walk	; 5
		Link			= From:0 Via:4 Via:5 To:3
		Link			= From:3 Via:1 Via:2 To:0
	End
	
	#include "..\..\..\includes\DefaultPosternGateInvisibilityUpdate.inc"
	
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
		;CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End

	Geometry              = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No

		
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End