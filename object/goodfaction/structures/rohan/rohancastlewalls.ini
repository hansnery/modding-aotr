;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;															;;
;;    CASTLE WALL PIECES FOR THE NEW WALL BUILD SYSTEM		;;
;;															;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
//----------------------------Small Walls----------------------------------
Object RohanWallSegmentSmall
  
	// *** ART Parameters ***
  
  	SelectPortrait  =  BPRohanWall
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = RBWallSeg_SKN
		End

		ModelConditionState = SNOW BUILD_PLACEMENT_CURSOR
			Model = RBWallSeg_SKN
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End
		
		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model = RBWallSeg_SKN
		End
					
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
; 			End
			StateName = STATE_None
		End	
		;------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = RBWallSeg_BLD
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = RBWallSeg_BLD
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  RBWallSeg_BLD
				AnimationName     =  RBWallSeg_BLD.RBWallSeg_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End
		ModelConditionState   = PARTIALLY_CONSTRUCTED 
			Model               = RBWallSeg_BLD
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		AnimationState        = PARTIALLY_CONSTRUCTED
			Animation           =  RBWallSeg_BLD
				AnimationName     =  RBWallSeg_BLD.RBWallSeg_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End
;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;			Model	= DBWallN_A
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = RBWallSeg_BLD
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = RBWallSeg_BLD
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = RBWallSeg_BLD
				AnimationName     = RBWallSeg_BLD.RBWallSeg_BLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		;--damaged building	  
		ModelConditionState  = DAMAGED
			Model         = RBWallSeg_D1
		End	
		AnimationState = DAMAGED
			Animation			=	DamagedAnimation
				AnimationName		=	RBWallSeg_D1.RBWallSeg_D1
				AnimationMode		=	ONCE
   			End
			EnteringStateFX	= FX_WallDamaged
		End	 

		ModelConditionState  = REALLYDAMAGED
			Model         = RBWallSeg_D2
		End
		
		AnimationState = REALLYDAMAGED
			Animation			=	DamagedAnimation
				AnimationName		=	RBWallSeg_D2.RBWallSeg_D2
				AnimationMode		=	ONCE
   			End
			EnteringStateFX	= FX_WallDamaged
		End	 

		ModelConditionState  = COLLAPSING
			Model         = RBWallSeg_D3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 RBWallSeg_D3.RBWallSeg_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
			EnteringStateFX			= FX_StructureMediumCollapse
		End
		
		ModelConditionState  = RUBBLE
			Model         = RBWallSeg_Rub
		End  		
		AnimationState = RUBBLE
			BeginScript
				CurDrawableHideSubObject("ModuleTag_DrawFloor")
			EndScript
		End	
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End		
		AnimationState = POST_RUBBLE
		End
		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End		
		AnimationState = POST_COLLAPSE
		End 
;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallseg_skn ;
;			;Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState = SNOW  
			Model = RBWallSeg_SKN ;
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End	
	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState  = COLLAPSING
			Model         = dbwallseg_rub
		End
		
		ModelConditionState  = RUBBLE
			Model         = dbwallseg_rub
		End
	    
		ModelConditionState  = POST_RUBBLE
			Model         = dbwallseg_rub
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End
   
    Draw = W3DFloorDraw ModuleTag_DrawFloor    
  		StaticModelLODMode		=	yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName				=	GBWallN_Bib
  		WeatherTexture			=	SNOWY GBWall_Bib_Snow.tga
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
  		HideIfModelConditions	=	COLLAPSING
  		HideIfModelConditions	=	RUBBLE
	End
  
  ; ***DESIGN parameters ***
  DisplayName         	= OBJECT:DwarvenCastleWallSegment
  Side                	= Rohan
  EditorSorting       	= STRUCTURE
  ThreatLevel 		= WALL_THREAT_LEVEL	;1.0
  ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
 
 
	CommandSet = RohanWallSegmentCommandSet
  ArmorSet
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End
 
  BuildCost           = 100 ; DWARVEN_WALLSEGMENT_SMALL_BUILDCOST
  BuildTime           = DWARVEN_WALLSEGMENT_SMALL_BUILDTIME
  VisionRange         = DWARVEN_WALLSEGMENT_SMALL_VISION_RANGE
  ShroudClearingRange = DWARVEN_WALLSEGMENT_SMALL_SHROUD_CLEAR

  ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= Gui_PlotSelect2
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

  ; *** ENGINEERING Parameters ***
  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE WALL_SEGMENT SCALEABLE_WALL DEFENSIVE_WALL MADE_OF_WOOD HAS_HEALTH_BAR
 
	Behavior						= GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= DWARVEN_WALLSEGMENT_SMALL_BUILDTIME
	End

   ;This is important to let the user select the rubble to begin self repair
  KeepSelectableWhenDead	= Yes
 
  Body                = StructureBody ModuleTag_05
		MaxHealth				= DWARVEN_WALLSEGMENT_SMALL_HEALTH
		MaxHealthDamaged		= DWARVEN_WALLSEGMENT_SMALL_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= DWARVEN_WALLSEGMENT_SMALL_HEALTH_REALLY_DAMAGED
  End

	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments

//	Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate 
//		MinCollapseDelay        = 000
//		MaxCollapseDelay        = 000
//		CollapseDamping         = .5
//		MaxShudder              = 0.6
//		MinBurstDelay           = 250
//		MaxBurstDelay           = 800
//		BigBurstFrequency       = 4
//		FXList                  = INITIAL   FX_StructureMediumCollapse
//		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
//		DestroyObjectWhenDone	= Yes
//		CollapseHeight			= 0
//	End
		 


	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
		ReplaceWith = RohanWallHubSmall
		TriggeredBy = Upgrade_DwarvenWallHub
		ConflictsWith = Upgrade_DwarvenWallRegularGate Upgrade_DwarvenWallPosternGate Upgrade_DwarvenWallTower Upgrade_DwarvenWallCatapult
	End
		
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
		ReplaceWith = RohanWallGateSmall
		TriggeredBy = Upgrade_DwarvenWallRegularGate
		ConflictsWith = Upgrade_DwarvenWallHub Upgrade_DwarvenWallPosternGate Upgrade_DwarvenWallTower Upgrade_DwarvenWallCatapult
	End

	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_PosternGate
		ReplaceWith = RohanWallPosternGateSmall
		TriggeredBy = Upgrade_DwarvenWallPosternGate
		ConflictsWith = Upgrade_DwarvenWallHub Upgrade_DwarvenWallRegularGate Upgrade_DwarvenWallTower Upgrade_DwarvenWallCatapult
	End

	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Tower
		ReplaceWith = RohanWallTowerSmall
		TriggeredBy = Upgrade_DwarvenWallTower
		ConflictsWith = Upgrade_DwarvenWallHub Upgrade_DwarvenWallRegularGate Upgrade_DwarvenWallPosternGate Upgrade_DwarvenWallCatapult
	End

	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Catapult
		ReplaceWith = RohanWallCatapultSmall
		TriggeredBy = Upgrade_DwarvenWallCatapult
		ConflictsWith = Upgrade_DwarvenWallHub Upgrade_DwarvenWallRegularGate Upgrade_DwarvenWallPosternGate Upgrade_DwarvenWallTower
	End

	Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
		;CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End

	Geometry              = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No
	  
	  
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object RohanWallTowerSmall
  ; *** ART Parameters ***
  	PlacementViewAngle  = -45  
  	SelectPortrait = BPRohanBattleTower
  
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes	

	    ExtraPublicBone = ARCHER01
		ExtraPublicBone = ARCHER02
		ExtraPublicBone = ARCHER03
		ExtraPublicBone = ARCHER04		
		
		DefaultModelConditionState
			Model				= RBWallHub_SKN
			;WeaponLaunchBone    = PRIMARY ARROW_
		End
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
;  			StateName = STATE_None
		End	

		;------------ New Build Up States coming soon. 
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = RBWallHub_SKN
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  RBWallHub_SKN
				AnimationName     =  RBWallHub_SKN.RBWallHub_SKN
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
;			Model		= DBWallTwrN_A
;			Texture		= DBFortress1.tga DBFortress_U.tga
;		End

		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = RBWallHub_SKN
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = RBWallHub_SKN
				AnimationName     = RBWallHub_SKN.RBWallHub_SKN
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
;			StateName			  = BeingConstructed
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End		


		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = rbwallhub_d1  
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = rbwallhub_d2
		ParticleSysBone FIREFX FireBuildingLarge
		ParticleSysBone FIREFX SmokeBuildingLarge
		End
	    
	    AnimationState = REALLYDAMAGED
      		; Animation				=	RubbleAnimation
				; AnimationName		=	 DBWallTwrN_D2.DBWallTwrN_D2
				; AnimationMode		=	ONCE
  			; End
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = rbwallhub_d3
		End
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallhub_d3.rbwallhub_d3
				AnimationMode		=	ONCE
  			End
			EnteringStateFX			= FX_StructureMediumCollapse
		End
		
		ModelConditionState  = DYING
			Model         = rbwallhub_d3
		End
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallhub_d3.rbwallhub_d3
				AnimationMode		=	ONCE
  			End
			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_COLLAPSE
		End 

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwalltwr_skn
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		
		ModelConditionState = SNOW  
			Model = RBWallHub_SKN
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End	 

		
	End
 
	Draw = W3DScriptedModelDraw ModuleTag_DrawBanners
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes	
		DefaultModelConditionState
			Model = rbwalltwr_bnr
		End
		IdleAnimationState
			Animation = IDLA
				AnimationName		=	RBWallTwr_SKL.RBWallTwr_IDLA
				AnimationMode			=	LOOP	
				AnimationBlendTime = 0
				AnimationSpeedFactorRange	= 0.5 0.5				
			End		
		End
		ModelConditionState  = COLLAPSING
			Model         = None
		End
		AnimationState = COLLAPSING
		End	
		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		ModelConditionState  = POST_RUBBLE
			Model         = None
		End
		AnimationState = POST_RUBBLE
		End
		ModelConditionState  = POST_COLLAPSE
		Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 		
	End 
 
	Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName = DBWallRmprtNBib
  		WeatherTexture		= SNOWY GBWall_Bib_Snow.tga 
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
	End
 
	; ***DESIGN parameters ***
	DisplayName         	= OBJECT:DwarvenCastleWallTowerSmall
	Side                	= Rohan
	EditorSorting       	= STRUCTURE
	ThreatLevel		= TOWER_THREAT_LEVEL	; 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = DWARVEN_WALLTOWER_SMALL_BUILDCOST
	BuildTime           = DWARVEN_WALLTOWER_SMALL_BUILDTIME           ; in seconds
	VisionRange         = DWARVEN_WALLTOWER_SMALL_VISION_RANGE        ; Shroud clearing distance
	ShroudClearingRange = DWARVEN_WALLTOWER_SMALL_SHROUD_CLEAR

	CommandSet	= SellableCommandSet

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= MenArrowTowerExpansionSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE CAN_ATTACK IGNORE_FOR_VICTORY WALL_UPGRADE SPAWNS_ARE_THE_WEAPONS
 
	Behavior = SpawnPointProductionExitUpdate ModuleTag_ProductionExit
		SpawnPointBoneName = ARCHER
	End

	Behavior = SpawnBehavior ModuleTag_Spawn
		SpawnNumber								= 4  
		InitialBurst							= 4 
		SpawnTemplateName						= RohanArcher_Slaved
		KillSpawnsBasedOnModelConditionState	= Yes		;//Must also set NoExitPath in QeueProductionExitUpdate. (So that the exit door is always available)
		SpawnReplaceDelay						= 999999
		CanReclaimOrphans						= No
		SpawnedRequireSpawner					= Yes		
		ShareUpgrades							= Yes
	End
 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	ArmorSet ;;,;;
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End

	;WeaponSet
	;	Conditions			= None
	;	Weapon				= PRIMARY LoneTowerAxeWeapon ;;,;; StructureAxeWeapon
	;	AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	;End
 
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
 		AutoAcquireEnemiesWhenIdle	= Yes
 		MoodAttackCheckRate			= 250
 	End
 
	Body = StructureBody ModuleTag_05
		MaxHealth = DWARVEN_WALLTOWER_SMALL_HEALTH
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
		;CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End
	 
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End												

	GeometryIsSmall       = No
	
	Geometry			  = BOX
	GeometryMajorRadius   = 15.0 
	GeometryMinorRadius   = 15.0 
	GeometryHeight        = 40.0
	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 10.0 
	GeometryMinorRadius   = 10.0 
	GeometryHeight        = 50.0
	GeometryOffset		  = X:0 Y:0 Z:40
	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No


	
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object RohanWallGateSmall
  ; *** ART Parameters ***
  
  	SelectPortrait = BPRohanWallGate
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = RBWallGate_SKN
		End
		
;		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
; 			StateName = STATE_None
;		End	



		; ;------------ New Build Up States coming soon. 
		; ModelConditionState   = SNOW AWAITING_CONSTRUCTION 
			; Model               = DBWallGateN_A
			; Texture = dbfortress.tga dbfortress_snow.tga
			; Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			; Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		; End
		; ModelConditionState   = AWAITING_CONSTRUCTION 
			; Model               = DBWallGateN_A
		; End
		; AnimationState        = AWAITING_CONSTRUCTION
			; Animation           =  DBWallGateN_A
				; AnimationName     =  DBWallGateN_A.DBWallGateN_A
				; AnimationMode     = MANUAL
				; AnimationBlendTime = 0
			; End
			; Flags				  = START_FRAME_FIRST
; ;			BeginScript
; ;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
; ;			EndScript
		; End

; ;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
; ;			Model		= DBWallGateN_A
; ;			Texture		= DBFortress1.tga DBFortress_U.tga
; ;		End

		; ModelConditionState   = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			; Model               = DBWallGateN_A
			; Texture = dbfortress.tga dbfortress_snow.tga
			; Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			; Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		; End	

		; ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			; Model               = DBWallGateN_A
		; End
	    
		; AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			; Animation           = DBWallGateN_A
				; AnimationName     = DBWallGateN_A.DBWallGateN_A
				; AnimationMode     = MANUAL
				; AnimationBlendTime = 0
			; End
			; Flags				  = START_FRAME_FIRST
; ;			StateName			  = BeingConstructed
; ;			BeginScript
; ;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
; ;			EndScript
		; ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		; End

;--------- damage states for the gate

		ModelConditionState   = DAMAGED
			Model               = rbwallgate_d
		End
		
		ModelConditionState   = REALLYDAMAGED
			Model               = rbwallgate_d2
		End

		; ModelConditionState  = COLLAPSING DOOR_1_OPENING
			; Model         = DBWallGateN_D4
		; End
		; AnimationState = COLLAPSING DOOR_1_OPENING
      		; Animation				=	RubbleAnimation
				; AnimationName		=	 DBWallGateN_D4.DBWallGateN_D4
				; AnimationMode		=	ONCE
  			; End
		; End
		
		ModelConditionState  = COLLAPSING
			Model         = rbwallgate_d3
		End
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallgate_d3.rbwallgate_d3
				AnimationMode		=	ONCE
  			End
			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = RUBBLE
			Model         = dbwallgate_rub
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_COLLAPSE
		End 
		ModelConditionState = SNOW  
			Model = RBWallGate_SKN
			Texture	= rbwallgate.tga rbwallgate_snow.tga
			Texture	= rbwallhub.tga rbwallhub_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End	  

				
;------ Door Animations
		ModelConditionState   = DOOR_1_OPENING
			Model               = RBWallGate_OPEN
		End
		AnimationState = DOOR_1_OPENING 
			Flags = START_FRAME_LAST
			StateName = Door_Open
			Animation				=	Death
				AnimationName		=	RBWallGate_OPEN.RBWallGate_OPEN
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			;EndScript
		End
		TransitionState = TRANS_Closed_To_Open
			Animation = Open 
				AnimationName	=	RBWallGate_OPEN.RBWallGate_OPEN
				AnimationMode	=	ONCE 
			End
		End
		ModelConditionState   = DOOR_1_CLOSING
			Model               = RBWallGate_OPEN
		End		
		AnimationState = DOOR_1_CLOSING 
			Flags = START_FRAME_FIRST
			StateName = Door_Close
			Animation				=	Death
				AnimationName		=	RBWallGate_OPEN.RBWallGate_OPEN
				AnimationMode		=	ONCE_BACKWARDS
				AnimationSpeedFactorRange	= 0.1 0.1				
			End
			;BeginScript
			;	Prev = CurDrawablePrevAnimationState()
			;	if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			;EndScript
		End
		TransitionState = TRANS_Open_To_Closed
			Animation = Open 
				AnimationName	=	RBWallGate_OPEN.RBWallGate_OPEN
				AnimationMode	=	ONCE_BACKWARDS
			End
		End

;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
;			Model = DBWallGateN_SKN
;			Texture = DBFortress1.tga DBFortress_U.tga
;		End
							
	End

 	Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName = DBWallGateN_Bib
  		WeatherTexture		= SNOWY DBWall_Bib_Snow.tga 
	End
	 
	; ***DESIGN parameters ***
	DisplayName         	= OBJECT:DwarvenCastleWallGateSmall
	Side                	= Rohan
	EditorSorting       	= STRUCTURE
	ThreatLevel 		= WALL_THREAT_LEVEL	; 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = DWARVEN_WALLGATE_SMALL_BUILDCOST
	BuildTime           = DWARVEN_WALLGATE_SMALL_BUILDTIME
	VisionRange         = DWARVEN_WALLGATE_SMALL_VISION_RANGE
	ShroudClearingRange = DWARVEN_WALLGATE_SMALL_SHROUD_CLEAR


	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= GateSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_UPGRADE MADE_OF_STONE BLOCKING_GATE WALL_GATE
	CommandSet			= CastleGateCommandSet
 
        ArmorSet
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End
 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		SpawnTimer					= -1.0							// Negative means no 'autoheal'
		RebuildTimeSeconds			= DWARVEN_WALLGATE_SMALL_BUILDTIME
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth         = DWARVEN_WALLGATE_SMALL_HEALTH
	End
	 
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay	= 5000
		;Sound				= INITIAL BuildingSink
	End												
	// These should always appear together on wall segments

	Behavior = GateOpenAndCloseBehavior ModuleTag_GATE
		ResetTimeInMilliseconds			= 3000				;important! this must be longer than the gates animation, ir it will twitch
		OpenByDefault					= No
		PercentOpenForPathing			= 50
		SoundOpeningGateLoop			= GateOpenStart
		SoundClosingGateLoop			= GateCloseStart
		SoundFinishedOpeningGate		= GateOpenEnd
		SoundFinishedClosingGate		= GateCloseEnd
		TimeBeforePlayingOpenSound		= 9500
		TimeBeforePlayingClosedSound	= 9500
	End
	
	Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
		AllowEnemies			= No
		AllowNonSkirmishAIUnits	= No
	End
	
	Behavior = AIGateUpdate ModuleTage_AIGateUpdate
		TriggerWidthX = 300.0
		TriggerWidthY = 150.0
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
;		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End

	GeometryIsSmall		  = No

	; right pillar
	Geometry              = BOX
	GeometryMajorRadius   = 10.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 75
	GeometryOffset        = X:0 Y:50 Z:0
	
	; left pillar
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 10.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 75
	GeometryOffset        = X:0 Y:-50 Z:0

	; Main
	AdditionalGeometry    = BOX
	GeometryName		  = "Closed"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 50.0  
	GeometryHeight        = 50
	
	; Left open
	AdditionalGeometry    = BOX
	GeometryName		  = "OpenLeft"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 40
	GeometryOffset        = X:0 Y:-30 Z:0
	
	; Right open
	AdditionalGeometry    = BOX
	GeometryName		  = "OpenRight"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 40
	GeometryOffset        = X:0 Y:30 Z:0

	// need some geometry points to tell enemy weapons where to hit.
	GeometryContactPoint = X:0	Y:50 Z:75
	GeometryContactPoint = X:0	Y:50 Z:10
	GeometryContactPoint = X:0	Y:-50 Z:10
	GeometryContactPoint = X:0	Y:-50 Z:75
	
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object RohanWallHubSmall
  	PlacementViewAngle  = -45
  ; *** ART Parameters ***
  
  	SelectPortrait = BPRohanWallHub
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = RBWallHub_SKN
		End

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
;			Model	= DBWallRmprtN_A
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End

		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
			BeginScript
				CurDrawableHideSubObject("SPEAR01")
				CurDrawableHideSubObject("SPEAR02")
				CurDrawableHideSubObject("SPEAR03")
				CurDrawableHideSubObject("FLAG01")
				CurDrawableHideSubObject("FLAG02")
				CurDrawableHideSubObject("FLAG03")			
			EndScript
		End
	
		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
			BeginScript
				CurDrawableHideSubObject("SPEAR01")
				CurDrawableHideSubObject("SPEAR02")
				CurDrawableHideSubObject("SPEAR03")
				CurDrawableHideSubObject("FLAG01")
				CurDrawableHideSubObject("FLAG02")
				CurDrawableHideSubObject("FLAG03")	
			EndScript
		End

		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED
			Model	= RBWallHub_BLD
			Texture	= rbwallhub.tga rbwallhub_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End 
		
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
			Model			= RBWallHub_BLD
			ParticleSysBone = NONE BuildingContructDust
		End

		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation					= UpAndStill
				AnimationName			= RBWallHub_BLD.RBWallHub_BLD
				AnimationMode			= MANUAL
			End
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End
		
		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = rbwallhub_d1 
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_BuildingDamaged ;FX_HubDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = rbwallhub_d2
		End
	    
	    AnimationState = REALLYDAMAGED
      		; Animation				=	RubbleAnimation
				; AnimationName		=	 DBWallRmprtN_D2.DBWallRmprtN_D2
				; AnimationMode		=	ONCE
  			; End
		    EnteringStateFX	= FX_BuildingReallyDamaged ;FX_HubDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = rbwallhub_d3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallhub_d3.rbwallhub_d3
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End

		ModelConditionState  = DYING
			Model         = rbwallhub_d3
		End
		
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallhub_d3.rbwallhub_d3
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End

		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
		End
		
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		
		AnimationState = POST_COLLAPSE
		End 

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallhub_skn
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		
		ModelConditionState = SNOW
			Model	= RBWallHub_SKN	
			Texture	= rbwallhub.tga rbwallhub_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End 
		
	End

	Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName = DBWallRmprtNBib
  		WeatherTexture		= SNOWY GBWall_Bib_Snow.tga 
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
	End
		 
	; ***DESIGN parameters ***
	DisplayName         = OBJECT:DwarvenWallHub
	Side                = Rohan
	EditorSorting       = STRUCTURE
	ThreatLevel 		= WALL_THREAT_LEVEL	; 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = 300 ; DWARVEN_WALLHUB_SMALL_BUILDCOST
	BuildTime           = DWARVEN_WALLHUB_SMALL_BUILDTIME           ; in seconds
	VisionRange         = DWARVEN_WALLHUB_SMALL_VISION_RANGE          ; Shroud clearing distance
	ShroudClearingRange = DWARVEN_WALLHUB_SMALL_SHROUD_CLEAR

	CommandSet = RohanCastleWallHubSmallCommandSet
        
    ArmorSet
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End
        
  ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= NeutralWallHubSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction
    ;VoiceFullyCreated				= EVA:GenericBuildingComplete-Builder

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound						; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB WALL_UPGRADE MADE_OF_WOOD	
	
//	Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
//		WorkerName		  = RohanWorkerNoSelect
//	End
	 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth         = DWARVEN_WALLHUB_SMALL_HEALTH
	End
	 
	Behavior				= SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End

	Behavior = GrantUpgradeCreate ModuleTag_GrantUpgrade
		UpgradeToGrant	= Upgrade_StructureLevel1
	End	
	
	Behavior = SubObjectsUpgrade ModuleTag_HideFlags
		TriggeredBy		= Upgrade_StructureLevel1
		HideSubObjects	= SPEAR01 SPEAR02 SPEAR03 FLAG01 FLAG02 FLAG03 
	End	

	Behavior = WallHubBehavior ModuleTag_Build_A_Span
	
		Options = OPTION_ONE
		MaxBuildoutDistance = 1000 ; DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS ;;,;; MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		
		StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR
		
;;,;;		MaxBuildoutDistance = 1500.0
	
		;;This defines the pattern built on flat terrain
		SegmentTemplateName = RohanWallSegmentSmall
		SegmentTemplateName = RohanWallSegmentSmall
		SegmentTemplateName = RohanWallSegmentSmall
		SegmentTemplateName = RohanWallSegmentSmall
		SegmentTemplateName = RohanWallSegmentSmall
;;,;; ; ;		SegmentTemplateName = DwarvenWallSegmentSmall
;;,;; ; ;		SegmentTemplateName = DwarvenWallSegmentSmall
;;,;; ; ;		SegmentTemplateName = DwarvenWallSegmentSmall
		SegmentTemplateName = RohanWallHubSmall
		
		BuilderRadius = 20

		HubCapTemplateName = RohanWallHubSmall
		DefaultSegmentTemplateName = RohanWallSegmentSmall
		
		CliffCapTemplateName = RohanWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]
		
	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius			= 60		;// How far we try to claim ground
		MaxIncome		= 0			;// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= 999999	;// How often (in msec) we give that much money
		HighPriority	= Yes		;// A high priority claim gets to pretend it was there first.
		Visible = No 		;// Don't show decal when a resource building is selected.
	End

		Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
;		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End


	Geometry              	= CYLINDER
	GeometryMajorRadius   	= 20.0 ; 
	GeometryMinorRadius   	= 20.0 ; 
	GeometryHeight        	= 70.0
	GeometryIsSmall       	= No

	; additional geometry, exactly same as the wall piece - if this isn't here we might get holes!	
	AdditionalGeometry      = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No
		
	GeometryContactPoint 	= X:35		Y:35	Z:0			Repair
	GeometryContactPoint 	= X:35		Y:0		Z:0			Repair
	GeometryContactPoint 	= X:22.954		Y:15.951	Z:0
	GeometryContactPoint 	= X:5.435		Y:-23.279	Z:0
	GeometryContactPoint	= X:-0.459		Y:-0.275	Z:116.828	Swoop
	
	Shadow					= SHADOW_VOLUME
	BuildCompletion			= PLACED_BY_PLAYER
	
End

;---------------------------------------------
Object RohanWallPosternGateSmall
  
  ; *** ART Parameters ***
  
  	SelectPortrait = BPRohanWallPostern
  	
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		
		ExtraPublicBone = Post01
		ExtraPublicBone = Post02
		ExtraPublicBone = Post03
		ExtraPublicBone = Post04
	
		DefaultModelConditionState
			Model = rbwallpost_skn
		End
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
;  			StateName = STATE_None
		End	


		;------------ New Build Up States coming soon. 
;		ModelConditionState   = AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
;			Model               = DBWallPGN_A
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState   = AWAITING_CONSTRUCTION SNOW
			;Model               = DBWallPGN_A
			;Texture = dbfortress.tga dbfortress_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End
		ModelConditionState   = AWAITING_CONSTRUCTION 
			;Model               = DBWallPGN_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			;Animation           =  DBWallPGN_A
			;	AnimationName     =  DBWallPGN_A.DBWallPGN_A
			;	AnimationMode     = MANUAL
			;	AnimationBlendTime = 0
			;End
			;Flags				  = START_FRAME_FIRST
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End
;		ModelConditionState		= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;			Model		= DBWallPGN_A
;			Texture		= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState		= SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Model		= DBWallPGN_A
			;Texture = dbfortress.tga dbfortress_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Model               = DBWallPGN_A
			;ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Animation           = DBWallPGN_A
			;	AnimationName     = DBWallPGN_A.DBWallPGN_A
			;	AnimationMode     = MANUAL
			;	AnimationBlendTime = 0
			;End
			;Flags				  = START_FRAME_FIRST
;			StateName			  = BeingConstructed
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End


		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = rbwallpost_d1 
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = rbwallpost_d1
		End
	    
	    AnimationState = REALLYDAMAGED
      		;Animation				=	RubbleAnimation
			;	AnimationName		=	 DBWallPGN_D2.DBWallPGN_D2
			;	AnimationMode		=	ONCE
  			;End
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
			;Model         = DBWallPGN_D3
		End
		
		AnimationState = COLLAPSING
      		;Animation				=	RubbleAnimation
			;	AnimationName		=	 DBWallPGN_D3.DBWallN_D3
			;	AnimationMode		=	ONCE
  			;End
			EnteringStateFX			= FX_StructureMediumCollapse
		End
		AnimationState = DYING
 			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = DYING
			Model         = None
		End

		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		
		AnimationState = POST_COLLAPSE
		End 

;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallpstrn_skn
;			;Texture	= DBFortress1.tga DBFortress_U.tga
;		End

		ModelConditionState = SNOW  
			Model = rbwallpost_skn
			Texture	= rbwallhub.tga rbwallhub_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End	 
	End
	
	Draw = W3DScriptedModelDraw ModuleTag_DrawWall
		AffectedByStealth		= No
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = rbwallseg_skn
		End

		ModelConditionState = SNOW BUILD_PLACEMENT_CURSOR
			Model = rbwallseg_skn
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End
		
		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model = rbwallseg_skn
		End
					
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
; 			End
			StateName = STATE_None
		End	
		

		;------------ New Build Up States coming soon. 
		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			;Model = dbwallseg_BLD
			;Texture = dbfortress.tga dbfortress_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End
				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			;Model               = dbwallseg_BLD
		End
		AnimationState        = AWAITING_CONSTRUCTION
			;Animation           =  dbwallseg_BLD
			;	AnimationName     =  dbwallseg_BLD.dbwallseg_BLD
			;	AnimationMode     = MANUAL
			;	AnimationBlendTime = 0
			;End
			;Flags				  = START_FRAME_FIRST
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
		End

;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;			Model	= dbwallseg_BLD
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End

		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Model = dbwallseg_BLD
			;Texture	= DBFortress1.tga DBFortress1_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Model               = dbwallseg_BLD
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			;Animation           = dbwallseg_BLD
			;	AnimationName     = dbwallseg_BLD.dbwallseg_BLD
			;	AnimationMode     = MANUAL
			;	AnimationBlendTime = 0
			;End
			;Flags				  = START_FRAME_FIRST
			;StateName			  = BeingConstructed
;			BeginScript
;				CurDrawablePlaySound("GondorBarracksBeginConstruction")
;			EndScript
			;ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End


		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = RBWallSeg_D1 ;DBWallN_D1  
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
		Model         = RBWallSeg_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		; Animation				=	RubbleAnimation
				; AnimationName		=	 DBWallN_D2.DBWallN_D2
				; AnimationMode		=	ONCE
  			; End
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = RBWallSeg_D3
		End		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 RBWallSeg_D3.RBWallSeg_D3
				AnimationMode		=	ONCE
  			End
		End
		ModelConditionState  = DYING
			Model         = RBWallSeg_D3
		End		
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 RBWallSeg_D3.RBWallSeg_D3
				AnimationMode		=	ONCE
  			End
		End
		ModelConditionState  = RUBBLE
			Model         = None  
		End 		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_RUBBLE
		End
		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_COLLAPSE
		End 
;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallseg_skn
;		;	Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState = SNOW  
			Model = rbwallseg_skn
			Texture	= rbwallhub.tga rbwallhub_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End	    

	End

 	Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName = DBWallPGN_Bib
  		WeatherTexture		= SNOWY DBWall_Bib_Snow.tga 
	End
	 
	; ***DESIGN parameters ***
	DisplayName         		= OBJECT:DwarvenCastleWallPosternGateSmall
	DisplayNameInvisibleForEnemy    = OBJECT:DwarvenCastleWallSegment
	Side                		= Rohan
	EditorSorting       		= STRUCTURE
	ThreatLevel 			= WALL_THREAT_LEVEL	; 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = DWARVEN_POSTERNGATE_SMALL_BUILDCOST
	BuildTime           = DWARVEN_POSTERNGATE_SMALL_BUILDTIME           ; in seconds
	VisionRange         = DWARVEN_POSTERNGATE_SMALL_VISION_RANGE         ; Shroud clearing distance
	ShroudClearingRange = DWARVEN_POSTERNGATE_SMALL_SHROUD_CLEAR

	ArmorSet	;;,;;
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End

	CommandSet	= SellableCommandSet

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= GondorPosternGateSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE IGNORE_FOR_VICTORY WALL_UPGRADE
 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth         = DWARVEN_POSTERNGATE_SMALL_HEALTH
	End
	 
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End												
	
	Behavior = DynamicPortalBehaviour PosternGatePortal
		ActivationDelaySeconds	= 0.0
		GenerateNow				= Yes
		
		ObjectFilter	= AOTR_POSTERNGATE_ALLOWABLE_OBJECTFILTER
		BonePrefix		= Post
		NumberOfBones	= 4
		WayPoint		= Index:0	Type:Walk	; 0
		WayPoint		= Index:1	Type:Walk	; 1
		WayPoint		= Index:2	Type:Walk	; 2
		WayPoint		= Index:3	Type:Walk	; 3
		WayPoint		= Index:2	Type:Walk	; 4
		WayPoint		= Index:1	Type:Walk	; 5
		Link			= From:0 Via:4 Via:5 To:3
		Link			= From:3 Via:1 Via:2 To:0
	End
	
	#include "..\..\..\includes\DefaultPosternGateInvisibilityUpdate.inc"
	
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter = ANY +DwarvenFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
		;CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End

	Geometry              = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No

		
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object RohanWallCatapultSmall
  	PlacementViewAngle  = -45 
  ; *** ART Parameters ***
  
  SelectPortrait  =  UPRohanMangonel
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = RBWallHub_SKN
		End

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
;			Model	= DBWallRmprtN_A
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End

		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
			BeginScript
				CurDrawableHideSubObject("SPEAR01")
				CurDrawableHideSubObject("SPEAR02")
				CurDrawableHideSubObject("SPEAR03")
				CurDrawableHideSubObject("FLAG01")
				CurDrawableHideSubObject("FLAG02")
				CurDrawableHideSubObject("FLAG03")			
			EndScript
		End
	
		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
			BeginScript
				CurDrawableHideSubObject("SPEAR01")
				CurDrawableHideSubObject("SPEAR02")
				CurDrawableHideSubObject("SPEAR03")
				CurDrawableHideSubObject("FLAG01")
				CurDrawableHideSubObject("FLAG02")
				CurDrawableHideSubObject("FLAG03")	
			EndScript
		End

		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED
			Model	= RBWallHub_BLD
			;Texture = dbfortress.tga dbfortress_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End 
		
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
			Model			= RBWallHub_BLD
			ParticleSysBone = NONE BuildingContructDust
		End

		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation					= UpAndStill
				AnimationName			= RBWallHub_BLD.RBWallHub_BLD
				AnimationMode			= MANUAL
			End
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End
		
		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = rbwallhub_d1 
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_BuildingDamaged ;FX_HubDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = rbwallhub_d2
		End
	    
	    AnimationState = REALLYDAMAGED
      		; Animation				=	RubbleAnimation
				; AnimationName		=	 DBWallRmprtN_D2.DBWallRmprtN_D2
				; AnimationMode		=	ONCE
  			; End
		    EnteringStateFX	= FX_BuildingReallyDamaged ;FX_HubDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = rbwallhub_d3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallhub_d3.rbwallhub_d3
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End


		ModelConditionState  = DYING
			Model         = rbwallhub_d3
		End
		
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallhub_d3.rbwallhub_d3
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust
		End


		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
		End
		
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		
		AnimationState = POST_COLLAPSE
		End 

;		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallhub_skn
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		
		ModelConditionState = SNOW
			Model	= RBWallHub_SKN	
			Texture	= rbwallhub.tga rbwallhub_snow.tga
			;Texture	= dberebwalls1.tga dberebwalls1_snow.tga
			;Texture	= dbhusbandry.tga dbhusbandry_snow.tga
		End 
		
	End

	Draw = W3DFloorDraw ModuleTag_DrawFloor    
   		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName = DBWallRmprtNBib
  		WeatherTexture		= SNOWY GBWall_Bib_Snow.tga 
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
	End
 
	// ***DESIGN parameters ***
	DisplayName         	= OBJECT:RohanCastleWallCatapultSmall
	Side                	= Rohan
	EditorSorting       	= STRUCTURE
	ThreatLevel 		= WALL_CATAPULT_THREAT_LEVEL	; 1.0
	 
	BuildCost           = DWARVEN_WALLCATAPULT_SMALL_BUILDCOST
	BuildTime           = DWARVEN_WALLCATAPULT_SMALL_BUILDTIME           ; in seconds
	VisionRange         = DWARVEN_WALLCATAPULT_SMALL_VISION_RANGE          ; Shroud clearing distance
	ShroudClearingRange = DWARVEN_WALLCATAPULT_SMALL_SHROUD_CLEAR
		
	ArmorSet ;;,;;
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End

	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= DwarvenCatapultExpansionSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE IGNORE_FOR_VICTORY WALL_UPGRADE // WALL_HUB
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= NoSound						;This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End
	Body                = StructureBody ModuleTag_05
		MaxHealth				= DWARVEN_WALLCATAPULT_SMALL_HEALTH
		MaxHealthDamaged		= DWARVEN_WALLCATAPULT_SMALL_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= DWARVEN_WALLCATAPULT_SMALL_HEALTH_REALLY_DAMAGED
	End
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius			= DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade			= Upgrade_DwarvenFortressDwarvenStonework
		ObjectFilter	= ANY +DwarvenFortressCitadel
	End
	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_DwarvenFortressDwarvenStonework
		AttributeModifier		= DwarvenStoneworkExpansion_Bonus
		;CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End
;	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
;		TriggeredBy			= Upgrade_DwarvenFortressDwarvenStonework		
;		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
;		Permanent			= Yes
;	End
	//Catapult Behaviors
	Behavior = ProductionUpdate ProductionUpdateModuleTag
	End
	Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
		UpgradeToGrant = Upgrade_TrebuchetTurret
		GiveOnBuildComplete = Yes // The ExemptStatus UnderConstruction hack doesn't work on foundation buildings.
	End
	Behavior = CommandSetUpgrade ModueTag_TrebCommandSet
		TriggeredBy			= Upgrade_TrebuchetTurret
		ConflictsWith		= Upgrade_HasWallTrebuchet 
		CommandSet			= RohanUpgradeCommandSetBuyNewCatapult
	End
	Behavior = CommandSetUpgrade ModueTag_TrebCommandSet3
		TriggeredBy			= Upgrade_HasWallTrebuchet Upgrade_TrebuchetTurret
		CommandSet			= SellableCommandSet
		RequiresAllTriggers	= Yes
	End
	Behavior = ObjectCreationUpgrade MakeTheFreeTreb
		TriggeredBy		= Upgrade_TrebuchetTurret
		Delay			= 0.0
		RemoveUpgrade	= Upgrade_WallTrebuchetButtonEnable
		GrantUpgrade	= Upgrade_HasWallTrebuchet
		DestroyWhenSold = Yes
		DeathAnimAndDuration = AnimState:DEATH_2 AnimTime:999999
		Offset			= X:0.3 Y:0.0 Z:62.0
	End
	Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
		TriggeredBy		= Upgrade_HasWallTrebuchet
		ConflictsWith	= Upgrade_OpenGarrison Upgrade_PosternGate
		Delay			= 0.0
		RemoveUpgrade	= Upgrade_WallTrebuchetButtonEnable
		ThingToSpawn	= RohanWallMangonel
		Offset			= X:0.3 Y:0.0 Z:62.0
		FadeInTime		= 600
	End
	Behavior = SlaveWatcherBehavior WatchTheTreb
		RemoveUpgrade		= Upgrade_HasWallTrebuchet			//when our slave dies, remove this upgrade, so we can get the upgrade again.
		GrantUpgrade		= Upgrade_WallTrebuchetButtonEnable	//when our slave dies, enable the button that allows us to buy a new one
		ShareUpgrades		= Yes								//So He'll get our Flaming Munitions
	End
	Behavior				= SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End		 
	GeometryIsSmall			= No
	Geometry              = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No
	AdditionalGeometry    	= CYLINDER
	GeometryMajorRadius   	= 25.0 
//	GeometryMinorRadius   	= 25.0 
	GeometryHeight        	= 50.0
	Shadow					= SHADOW_VOLUME
	BuildCompletion			= PLACED_BY_PLAYER
	
	Scale = 1.03
End

;--------------------------------------------------------

Object RohanWallCliffCap

	SelectPortrait  =  BPRohanWall
  
  ; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = rbwallcliff_skn
		End
		
		ModelConditionState = SNOW BUILD_PLACEMENT_CURSOR
			Model = rbwallcliff_skn
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End
		
		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model = rbwallcliff_skn
		End

		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
; 			End
			StateName = STATE_None
		End			
				
		;------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = rbwallcliff_bld
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = rbwallcliff_bld
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  rbwallcliff_bld
				AnimationName     =  rbwallcliff_bld.rbwallcliff_bld
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End
		ModelConditionState   = PARTIALLY_CONSTRUCTED 
			Model               = rbwallcliff_bld
		End
		AnimationState        = PARTIALLY_CONSTRUCTED
			Animation           =  rbwallcliff_bld
				AnimationName     =  rbwallcliff_bld.rbwallcliff_bld
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End
;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;			Model	= DBWallN_A
;			Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = rbwallcliff_bld
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = rbwallcliff_bld
		End	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = rbwallcliff_bld
				AnimationName     = rbwallcliff_bld.rbwallcliff_bld
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		;--damaged building	  
		ModelConditionState  = DAMAGED
			Model         = rbwallcliff_d
		End	
		AnimationState = DAMAGED
			; Animation			=	DamagedAnimation
				; AnimationName		=	RBWallSeg_D1.RBWallSeg_D1
				; AnimationMode		=	ONCE
   			; End
			EnteringStateFX	= FX_WallDamaged
		End	 

		ModelConditionState  = REALLYDAMAGED
			Model         = rbwallcliff_d
		End
		
		AnimationState = REALLYDAMAGED
			; Animation			=	DamagedAnimation
				; AnimationName		=	RBWallSeg_D2.RBWallSeg_D2
				; AnimationMode		=	ONCE
   			; End
			EnteringStateFX	= FX_WallDamaged
		End	 

		ModelConditionState  = COLLAPSING
			Model         = rbwallcliff_d3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 rbwallcliff_d3.rbwallcliff_d3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
			EnteringStateFX			= FX_StructureMediumCollapse
		End
		
		ModelConditionState  = RUBBLE
			Model         = RBWallSeg_Rub
		End  		
		AnimationState = RUBBLE
			BeginScript
				CurDrawableHideSubObject("ModuleTag_DrawFloor")
			EndScript
		End
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End		
		AnimationState = POST_RUBBLE
		End
		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End		
		AnimationState = POST_COLLAPSE
		End 
;		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
;			Model	= dbwallseg_skn ;
;			;Texture	= DBFortress1.tga DBFortress_U.tga
;		End
		ModelConditionState = SNOW  
			Model = rbwallcliff_skn ;
			Texture	= rbwallhub.tga rbwallhub_snow.tga
		End	
	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState  = COLLAPSING
			Model         = RBWallSeg_Rub
		End
		
		ModelConditionState  = RUBBLE
			Model         = RBWallSeg_Rub
		End
	    
		ModelConditionState  = POST_RUBBLE
			Model         = RBWallSeg_Rub
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End
   
    Draw = W3DFloorDraw ModuleTag_DrawFloor    
  		StaticModelLODMode		=	yes ; Will append M or L to the skin name depending on GameLOD
  		ModelName				=	GBWallN_Bib
  		WeatherTexture			=	SNOWY GBWall_Bib_Snow.tga
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
  		HideIfModelConditions	=	COLLAPSING
  		HideIfModelConditions	=	RUBBLE
	End
  
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:GondorCastleWallSegment
  Side                = Rohan
  EditorSorting       = STRUCTURE
  ThreatLevel 		= WALL_THREAT_LEVEL	; 1.0
  ThreatBreakdown ModuleTag_DetailedThreat
	AIKindOf = WALL
  End
 
	CommandSet			= DwarvenWallCliffCapCommandSet
  
  ArmorSet
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End
 
	BuildCost           = 100 ; MEN_WALLSEGMENT_SMALL_BUILDCOST
	BuildTime           = MEN_WALLSEGMENT_SMALL_BUILDTIME
	VisionRange         = MEN_WALLSEGMENT_SMALL_VISION_RANGE
	ShroudClearingRange = MEN_WALLSEGMENT_SMALL_SHROUD_CLEAR

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE DEFENSIVE_WALL MADE_OF_STONE CAN_CAST_REFLECTIONS
 
	Behavior						= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= NoSound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth         = MEN_WALLSEGMENT_SMALL_HEALTH
	End

	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay	= 5000
	End												
	// These should always appear together on wall segments


	Geometry              	= BOX
	GeometryMajorRadius   	= 10.0 
	GeometryMinorRadius   	= 40.0   
	GeometryHeight			= 80
	GeometryIsSmall			= No
	GeometryOffset			= X:0 Y:-20 Z:-40
  
  
  Shadow                = SHADOW_VOLUME
  BuildCompletion     = PLACED_BY_PLAYER
End